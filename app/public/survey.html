<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

      <!-- Compiled and minified CSS -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

      <!-- Compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
              
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

    <div class="container main" id="form">
        <div class="title"> Which NYC Neighborhood should I live in?</div>
        <div class="row">
            <form id="register">
            <div class="input-field col s12">
            <input id="name" type="text" class="validate">
            <label for="name">Name</label>
            </div>
        </div>
        
        <div class="row">
            <div class="input-field col s12">
            <input id="photo" type="text" class="validate">
            <label for="photo">Photo</label>
            </div>
        </div>

        <div class="row" id="question-one">
            <h4>Question One</h4>

            <h6>What kind of pet do you own?</h6>
            <p>
                <label>
                <input name="group1" type="radio" value="1" />
                <span>Three kittens</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group1" type="radio" value="2" />
                <span>A Pure-bred Jack-Russell Terrier</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group1" type="radio" value="3" />
                <span>I saw a mouse the other day</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group1" type="radio" value="4" />
                <span>My camera is my pet</span>
                </label>
            </p>
        </div>

         <div class="row" id="question-two">
            <h4>Question Two</h4>

            <h6>Which of the following sounds like an ideal dinner to you?</h6>
            <p>
                <label>
                <input name="group2" type="radio" value="1" />
                <span>Ramen Noodles</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group2" type="radio" value="2" />
                <span>Baked, skinless chicken-breast with steamed veggies</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group2" type="radio" value="3" />
                <span>Halal truck, baby</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group2" type="radio" value="4" />
                <span>My camera is my dinner</span>
                </label>
            </p>
        </div>

         <div class="row" id="question-one">
            <h4>Question Three</h4>

            <h6>You lay asleep at night worrying:</h6>
            <p>
                <label>
                <input name="group3" type="radio" value="1" />
                <span>Is this the night that Gazorpazorps finally occupy our planet?</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group3" type="radio" value="2" />
                <span>Those crooks at Charles Schwab are going to bleed me dry, I just know it</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group3" type="radio" value="3" />
                <span>I really hope my paycheck comes through tomorrow...</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group3" type="radio" value="4" />
                <span>My camera's been stolen</span>
                </label>
            </p>
        </div>

         <div class="row">
            <h4>Question Four</h4>

            <h6>The last conversation I had was with:</h6>
            <p>
                <label>
                <input name="group4" type="radio" value="1" />
                <span>My mom</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group4" type="radio" value="2" />
                <span>My son's acting coach</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group4" type="radio" value="3" />
                <span>The clerk at the bodega across the street</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group4" type="radio" value="4" />
                <span>My camera</span>
                </label>
            </p>
        </div>

         <div class="row">
            <h4>Question Five</h4>

            <h6>On a scale of 1 to 3, my level of fitness is roughly a:</h6>
            <p>
                <label>
                <input name="group5" type="radio" value="1" />
                <span>One</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group5" type="radio" value="2" />
                <span>Two</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group5" type="radio" value="3" />
                <span>Three</span>
                </label>
            </p>
            <p>
                <label>
                <input name="group5" type="radio" value="4" />
                <span>Photograph</span>
                </label>
            </p>
        </div>

        </form>

        <button id="submit" class="btn waves-effect waves-light" type="submit" name="action">Submit</button>
        
    <br>
        <a href=/api/friends>Friends API</a>
        <a href=/api/neighborhoods>Neighborhoods API</a>
    <br>
        
    </div>

    <div class ="container main" id="results"  style="display: none">
        <h3>You're best suited for... <strong><span id="neighborhood-name"></span></strong></h4>
            <br>
        <img src="#" id="neighborhood-image">
            <br>
        <h5><strong>Description: </strong><span id="neighborhood-description"></span></h5>
        <h5><strong>Quote From a Resident: </strong><span id="neighborhood-quote"></span></h5>

        <a class ="btn" href="/">Return to Home &gt;&gt;</a>
        
        
        <button id="other-friends" class="btn waves-effect waves-light" type="submit" name="action">Other Friends Living Here &gt;&gt;</button>
        
        

    <br>
        <a href=/api/friends>Friends API</a>
        <a href=/api/neighborhoods>Neighborhoods API</a>
    <br>

    </div>
   
    
      
  <script type="text/javascript">
  
  // Initialize materialize JS --
  M.AutoInit();

  // 'Submit' button click listener => post request: 
  $("#submit").on("click", function(event) {

    event.preventDefault();

    // Answers to questions are stored in array:
    var answers = [];

    answers.push(parseInt($("input[name='group1']:checked").val()));
    answers.push(parseInt($("input[name='group2']:checked").val()));
    answers.push(parseInt($("input[name='group3']:checked").val()));
    answers.push(parseInt($("input[name='group4']:checked").val()));
    answers.push(parseInt($("input[name='group5']:checked").val()));
    

    console.log(answers);

    
    //'New Friend' object created and assigned key-values from page:
    var newFriend = {
      name: $("#name").val().trim(),
      photo: $("#photo").val().trim(),
      answers: answers,
    };

    // Initial post request made to the neighborhoods API, where a matching neighborrhood is found:
    $.post("/api/neighborhoods", newFriend, function (data) {

        if (data) {
            console.log(data);
        }

        else {
            console.log('error');
        }

    }).then(function(data) {
        console.log(data);

        // After a neighborhood has been found, append the matching neighborhood's information to the page:
        $("#neighborhood-name").text(data.name);
        $("#neighborhood-description").text(data.bio);
        $("#neighborhood-quote").text(data.quote);
        $("#neighborhood-image").attr("src", data.image);

        $("#form").fadeOut();
        $("#results").fadeIn();

        // The matching neighborhood is added as a key-value pair to our 'newFriend' object:
        newFriend.neighborhood = data.name;

        // Finally, that new friend object is pushed to our friendData array on the back-ebd via a second post request:
        $.post("/api/friends", newFriend, function (data) {

            if (data) {
                console.log(data);
            }

            else {
                console.log('error');
            }
        })

    })
  })

  </script>    
</body>
</html>